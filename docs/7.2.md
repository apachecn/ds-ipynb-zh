# 7.2 æ•°æ®æ•´ç†

> åŸæ–‡ï¼š[Data Wrangling](https://github.com/donnemartin/viz/blob/master/githubstats/data_wrangling.ipynb)
> 
> è¯‘è€…ï¼š[é£é¾™](https://github.com/wizardforcel)
> 
> åè®®ï¼š[CC BY-NC-SA 4.0](http://creativecommons.org/licenses/by-nc-sa/4.0/)ï¼ˆåŸæ–‡åè®®ï¼š[Apache License 2.0](https://github.com/donnemartin/data-science-ipython-notebooks/blob/master/LICENSE)ï¼‰

## æ•°æ®æµ

![Imgur](../img/7-2-1.png)

ç›´æ¥ä» GitHub æŒ–æ˜æ•°æ®ï¼Œ`Viz`ç”± [GitHub API](https://developer.github.com/v3/) æä¾›æ”¯æŒï¼Œå¹¶åˆ©ç”¨ä»¥ä¸‹å†…å®¹ï¼š
* é€šè¿‡ Python ä½¿ç”¨[`github3.py`](https://github.com/sigmavirus24/github3.py) è®¿é—® GitHub APIã€‚
* å°†ä¸‹é¢çš„ [IPython ç¬”è®°æœ¬](https://github.com/donnemartin/viz/blob/master/githubstats/data_wrangling.ipynb) ä¸­çš„[`pandas`](https://github.com/pydata/pandas)ç”¨äºæ•°æ®æ•´ç†ã€‚
* é€šè¿‡[`geocoder`](https://github.com/DenisCarriere/geocoder)ä½¿ç”¨ [Google åœ°å›¾ API](https://developers.google.com/maps/?hl=en) è®¿é—®ä½ç½®æ•°æ®ã€‚
* å°† [Tableau Public](https://public.tableau.com/s/) ç”¨äºå¯è§†åŒ–ã€‚

å°†æ¥ï¼Œ[Google BigQuery](https://cloud.google.com/bigquery/) å’Œ [GitHub Archive](https://www.githubarchive.org/) ä¹Ÿå¯ä»¥è¡¥å…… GitHub APIã€‚

## å¯¼å…¥

```py
import re

import pandas as pd
```

## å‡†å¤‡ä»“åº“æ•°æ®

åŠ è½½ä»“åº“æ•°æ®å¹¶åˆ é™¤é‡å¤ï¼š

```py
repos = pd.read_csv("data/2017/repos-dump.csv", quotechar='"', skipinitialspace=True)
print('Shape before dropping duplicates', repos.shape)
repos = repos.drop_duplicates(subset='full_name', keep='last')
print('Shape after  dropping duplicates', repos.shape)
repos.head()

'''
Shape before dropping duplicates (8697, 5)
Shape after  dropping duplicates (8697, 5)
'''
```

|  | full_name | stars | forks | description | language |
| --- | --- | --- | --- | --- | --- | --- |
| 0 | thedaviddias/Front-End-Checklist | 24267 | 2058 | ğŸ—‚ The perfect Front-End Checklist for modern w... | JavaScript |
| 1 | GoogleChrome/puppeteer | 21976 | 1259 | Headless Chrome Node API | JavaScript |
| 2 | parcel-bundler/parcel | 13981 | 463 | ğŸ“¦ğŸš€ Blazing fast, zero configuration web applic... | JavaScript |
| 3 | Chalarangelo/30-seconds-of-code | 13466 | 1185 | Curated collection of useful Javascript snippe... | JavaScript |
| 4 | wearehive/project-guidelines | 11279 | 970 | A set of best practices for JavaScript projects | JavaScript |

å°†`user`å’Œ`repo`ä»`full_name`åˆ†ç¦»ï¼Œå˜æˆæ–°åˆ—ï¼š

```py
def extract_user(line):
    return line.split('/')[0]

def extract_repo(line):
    return line.split('/')[1]

repos['user'] = repos['full_name'].str[:].apply(extract_user)
repos['repo'] = repos['full_name'].str[:].apply(extract_repo)
print(repos.shape)
repos.head()

# (8697, 7)
```

|  | full_name | stars | forks | description | language | user | repo |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 0 | thedaviddias/Front-End-Checklist | 24267 | 2058 | ğŸ—‚ The perfect Front-End Checklist for modern w... | JavaScript | thedaviddias | Front-End-Checklist |
| 1 | GoogleChrome/puppeteer | 21976 | 1259 | Headless Chrome Node API | JavaScript | GoogleChrome | puppeteer |
| 2 | parcel-bundler/parcel | 13981 | 463 | ğŸ“¦ğŸš€ Blazing fast, zero configuration web applic... | JavaScript | parcel-bundler | parcel |
| 3 | Chalarangelo/30-seconds-of-code | 13466 | 1185 | Curated collection of useful Javascript snippe... | JavaScript | Chalarangelo | 30-seconds-of-code |
| 4 | wearehive/project-guidelines | 11279 | 970 | A set of best practices for JavaScript projects | JavaScript | wearehive | project-guidelines |

## å‡†å¤‡ç”¨æˆ·æ•°æ®

åŠ è½½ç”¨æˆ·æ•°æ®å¹¶åˆ é™¤é‡å¤ï¼š

```py
users = pd.read_csv("data/2017/user-geocodes-dump.csv", quotechar='"', skipinitialspace=True)
print('Shape before dropping duplicates', users.shape)
users = users.drop_duplicates(subset='id', keep='last')
print('Shape after  dropping duplicates', users.shape)
users.head()

'''
Shape before dropping duplicates (6426, 8)
Shape after  dropping duplicates (6426, 8)
'''
```

|  | id | name | type | location | lat | long | city | country |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 0 | dns-violations | NaN | Organization | NaN | NaN | NaN | NaN | NaN |
| 1 | hannob | Hanno BÃ¶ck | User | Berlin | 52.520007 | 13.404954 | Berlin | Germany |
| 2 | takecian | Takeshi Fujiki | User | Tokyo, Japan | 35.689487 | 139.691706 | Tokyo | Japan |
| 3 | jtomschroeder | Tom Schroeder | User | Chicago | 41.878114 | -87.629798 | Chicago | United States |
| 4 | wapiflapi | Wannes Rombouts | User | France | 46.227638 | 2.213749 | NaN | France |

å°†`id`åˆ—é‡å‘½åä¸º`user`ï¼š

```py
users.rename(columns={'id': 'user'}, inplace=True)
users.head()
```

|  | user | name | type | location | lat | long | city | country |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 0 | dns-violations | NaN | Organization | NaN | NaN | NaN | NaN | NaN |
| 1 | hannob | Hanno BÃ¶ck | User | Berlin | 52.520007 | 13.404954 | Berlin | Germany |
| 2 | takecian | Takeshi Fujiki | User | Tokyo, Japan | 35.689487 | 139.691706 | Tokyo | Japan |
| 3 | jtomschroeder | Tom Schroeder | User | Chicago | 41.878114 | -87.629798 | Chicago | United States |
| 4 | wapiflapi | Wannes Rombouts | User | France | 46.227638 | 2.213749 | NaN | France |

## åˆå¹¶ä»“åº“å’Œç”¨æˆ·æ•°æ®

å·¦è¿æ¥ä»“åº“å’Œç”¨æˆ·ï¼š

```py
repos_users = pd.merge(repos, users, on='user', how='left')
print('Shape repos:', repos.shape)
print('Shape users:', users.shape)
print('Shape repos_users:', repos_users.shape)
repos_users.head()

'''
Shape repos: (8697, 7)
Shape users: (6426, 8)
Shape repos_users: (8697, 14)
'''
```

|  | full_name | stars | forks | description | language | user | repo | name | type | location | lat | long | city | country |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 0 | thedaviddias/Front-End-Checklist | 24267 | 2058 | ğŸ—‚ The perfect Front-End Checklist for modern w... | JavaScript | thedaviddias | Front-End-Checklist | David Dias | User | France, Mauritius, Canada | NaN | NaN | NaN | NaN |
| 1 | GoogleChrome/puppeteer | 21976 | 1259 | Headless Chrome Node API | JavaScript | GoogleChrome | puppeteer | NaN | Organization | NaN | NaN | NaN | NaN | NaN |
| 2 | parcel-bundler/parcel | 13981 | 463 | ğŸ“¦ğŸš€ Blazing fast, zero configuration web applic... | JavaScript | parcel-bundler | parcel | Parcel | Organization | NaN | NaN | NaN | NaN | NaN |
| 3 | Chalarangelo/30-seconds-of-code | 13466 | 1185 | Curated collection of useful Javascript snippe... | JavaScript | Chalarangelo | 30-seconds-of-code | Angelos Chalaris | User | Athens, Greece | 37.983810 | 23.727539 | Athens | Greece |
| 4 | wearehive/project-guidelines | 11279 | 970 | A set of best practices for JavaScript projects | JavaScript | wearehive | project-guidelines | Hive | Organization | London | 51.507351 | -0.127758 | London | United Kingdom |

## æ•´ç†ä»“åº“å’Œç”¨æˆ·æ•°æ®

é‡æ–°æ’åºåˆ—ï¼š

```py
repos_users = repos_users.reindex_axis(['full_name',
                                        'repo',
                                        'description',
                                        'stars',
                                        'forks',
                                        'language',
                                        'user',
                                        'name',
                                        'type',
                                        'location',
                                        'lat',
                                        'long',
                                        'city',
                                        'country'], axis=1)
print(repos_users.shape)
repos_users.head()

# (8697, 14)
```

|  | full_name | repo | description | stars | forks | language | user | name | type | location | lat | long | city | country |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 0 | thedaviddias/Front-End-Checklist | Front-End-Checklist | ğŸ—‚ The perfect Front-End Checklist for modern w... | 24267 | 2058 | JavaScript | thedaviddias | David Dias | User | France, Mauritius, Canada | NaN | NaN | NaN | NaN |
| 1 | GoogleChrome/puppeteer | puppeteer | Headless Chrome Node API | 21976 | 1259 | JavaScript | GoogleChrome | NaN | Organization | NaN | NaN | NaN | NaN | NaN |
| 2 | parcel-bundler/parcel | parcel | ğŸ“¦ğŸš€ Blazing fast, zero configuration web applic... | 13981 | 463 | JavaScript | parcel-bundler | Parcel | Organization | NaN | NaN | NaN | NaN | NaN |
| 3 | Chalarangelo/30-seconds-of-code | 30-seconds-of-code | Curated collection of useful Javascript snippe... | 13466 | 1185 | JavaScript | Chalarangelo | Angelos Chalaris | User | Athens, Greece | 37.983810 | 23.727539 | Athens | Greece |
| 4 | wearehive/project-guidelines | project-guidelines | A set of best practices for JavaScript projects | 11279 | 970 | JavaScript | wearehive | Hive | Organization | London | 51.507351 | -0.127758 | London | United Kingdom |

## æ·»åŠ æ•´ä½“æ’å

æ ¹æ®æ˜Ÿæ•°å¯¹æ¯ä¸ªå…ƒç´ æ’åï¼š

```py
repos_users['rank'] = repos_users['stars'].rank(ascending=False)
print(repos_users.shape)
repos_users.head()

# (8697, 15)
```

|  | full_name | repo | description | stars | forks | language | user | name | type | location | lat | long | city | country | rank |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 0 | thedaviddias/Front-End-Checklist | Front-End-Checklist | ğŸ—‚ The perfect Front-End Checklist for modern w... | 24267 | 2058 | JavaScript | thedaviddias | David Dias | User | France, Mauritius, Canada | NaN | NaN | NaN | NaN | 3 |
| 1 | GoogleChrome/puppeteer | puppeteer | Headless Chrome Node API | 21976 | 1259 | JavaScript | GoogleChrome | NaN | Organization | NaN | NaN | NaN | NaN | NaN | 4 |
| 2 | parcel-bundler/parcel | parcel | ğŸ“¦ğŸš€ Blazing fast, zero configuration web applic... | 13981 | 463 | JavaScript | parcel-bundler | Parcel | Organization | NaN | NaN | NaN | NaN | NaN | 11 |
| 3 | Chalarangelo/30-seconds-of-code | 30-seconds-of-code | Curated collection of useful Javascript snippe... | 13466 | 1185 | JavaScript | Chalarangelo | Angelos Chalaris | User | Athens, Greece | 37.983810 | 23.727539 | Athens | Greece | 13 |
| 4 | wearehive/project-guidelines | project-guidelines | A set of best practices for JavaScript projects | 11279 | 970 | JavaScript | wearehive | Hive | Organization | London | 51.507351 | -0.127758 | London | United Kingdom | 16 |

## éªŒè¯ç»“æœï¼šç”¨æˆ·

ç­‰ä»·äº[ GitHub æœç´¢æŸ¥è¯¢](https://github.com/search?utf8=%E2%9C%93&q=created%3A2017-01-01..2017-12-31+stars%3A%3E%3D100+user%3Adonnemartin&type=Repositories&ref=searchresults)ï¼š`createdï¼š2017-01-01..2017-12-31 starsï¼š> = 100 userï¼šdonnemartin`

æ³¨æ„ï¼šæ•°æ®å¯èƒ½ç¨å¾®å·®äº†ä¸€äº›ï¼Œå› ä¸ºæœç´¢æŸ¥è¯¢å°†è€ƒè™‘æ‰§è¡ŒæŸ¥è¯¢æ—¶çš„æ•°æ®ã€‚ æ­¤ç¬”è®°æœ¬ä¸­çš„æ•°æ®äº 2017 å¹´ 1 æœˆ 1 æ—¥é‡‡é›†ï¼Œæ¥â€œå†»ç»“â€ 2017 å¹´çš„ç»“æœã€‚ä» 2017 å¹´ 1 æœˆ 1 æ—¥å¼€å§‹ï¼Œæ‰§è¡Œæœç´¢çš„æ—¶é—´è¶Šé•¿ï¼Œå·®å¼‚è¶Šå¤§ã€‚

```py
repos_users[repos_users['user'] == 'donnemartin']
```

|  | full_name | repo | description | stars | forks | language | user | name | type | location | lat | long | city | country | rank |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 3308 | donnemartin/system-design-primer | system-design-primer | Learn how to design large-scale systems. Prep ... | 21780 | 2633 | Python | donnemartin | Donne Martin | User | Washington, D.C. | 38.907192 | -77.036871 | Washington | United States | 5 |

## éªŒè¯ç»“æœï¼šPython ä»“åº“

ç­‰ä»·äº[ GitHub æœç´¢æŸ¥è¯¢](https://github.com/search?utf8=%E2%9C%93&q=created%3A2017-01-01..2017-12-31+stars%3A%3E%3D100+language%3Apython&type=Repositories&ref=searchresults)ï¼š`created:2017-01-01..2017-12-31 stars:>=100 language:python`

æ³¨æ„ï¼šæ•°æ®å¯èƒ½ç¨å¾®å·®äº†ä¸€äº›ï¼Œå› ä¸ºæœç´¢æŸ¥è¯¢å°†è€ƒè™‘æ‰§è¡ŒæŸ¥è¯¢æ—¶çš„æ•°æ®ã€‚ æ­¤ç¬”è®°æœ¬ä¸­çš„æ•°æ®äº 2017 å¹´ 1 æœˆ 1 æ—¥é‡‡é›†ï¼Œæ¥â€œå†»ç»“â€ 2017 å¹´çš„ç»“æœã€‚ä» 2017 å¹´ 1 æœˆ 1 æ—¥å¼€å§‹ï¼Œæ‰§è¡Œæœç´¢çš„æ—¶é—´è¶Šé•¿ï¼Œå·®å¼‚è¶Šå¤§ã€‚

```py
print(repos_users[repos_users['language'] == 'Python'].shape)
repos_users[repos_users['language'] == 'Python'].head()

# (1357, 15)
```

|  | full_name | repo | description | stars | forks | language | user | name | type | location | lat | long | city | country | rank |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 3308 | donnemartin/system-design-primer | system-design-primer | Learn how to design large-scale systems. Prep ... | 21780 | 2633 | Python | donnemartin | Donne Martin | User | Washington, D.C. | 38.907192 | -77.036871 | Washington | United States | 5 |
| 3309 | python/cpython | cpython | The Python programming language | 15060 | 3779 | Python | python | Python | Organization | NaN | NaN | NaN | NaN | NaN | 9 |
| 3310 | ageitgey/face_recognition | face_recognition | The world's simplest facial recognition api fo... | 8487 | 1691 | Python | ageitgey | Adam Geitgey | User | Various places | NaN | NaN | NaN | NaN | 31 |
| 3311 | tonybeltramelli/pix2code | pix2code | pix2code: Generating Code from a Graphical Use... | 8037 | 605 | Python | tonybeltramelli | Tony Beltramelli | User | Denmark | NaN | NaN | NaN | NaN | 34 |
| 3312 | google/python-fire | python-fire | Python Fire is a library for automatically gen... | 7663 | 386 | Python | google | Google | Organization | NaN | NaN | NaN | NaN | NaN | 36 |

## éªŒè¯ç»“æœï¼šæ‰€æœ‰ä»“åº“

ç­‰ä»·äº[ GitHub æœç´¢æŸ¥è¯¢](https://github.com/search?utf8=%E2%9C%93&q=created%3A2017-01-01..2017-12-31+stars%3A%3E%3D100&type=Repositories&ref=searchresults)ï¼š`created:2017-01-01..2017-12-31 stars:>=100`

æ³¨æ„ï¼šæ•°æ®å¯èƒ½ç¨å¾®å·®äº†ä¸€äº›ï¼Œå› ä¸ºæœç´¢æŸ¥è¯¢å°†è€ƒè™‘æ‰§è¡ŒæŸ¥è¯¢æ—¶çš„æ•°æ®ã€‚ æ­¤ç¬”è®°æœ¬ä¸­çš„æ•°æ®äº 2017 å¹´ 1 æœˆ 1 æ—¥é‡‡é›†ï¼Œæ¥â€œå†»ç»“â€ 2017 å¹´çš„ç»“æœã€‚ä» 2017 å¹´ 1 æœˆ 1 æ—¥å¼€å§‹ï¼Œæ‰§è¡Œæœç´¢çš„æ—¶é—´è¶Šé•¿ï¼Œå·®å¼‚è¶Šå¤§ã€‚

```py
print(repos_users.shape)
repos_users.head()

# (8697, 15)
```

|  | full_name | repo | description | stars | forks | language | user | name | type | location | lat | long | city | country | rank |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 0 | thedaviddias/Front-End-Checklist | Front-End-Checklist | ğŸ—‚ The perfect Front-End Checklist for modern w... | 24267 | 2058 | JavaScript | thedaviddias | David Dias | User | France, Mauritius, Canada | NaN | NaN | NaN | NaN | 3 |
| 1 | GoogleChrome/puppeteer | puppeteer | Headless Chrome Node API | 21976 | 1259 | JavaScript | GoogleChrome | NaN | Organization | NaN | NaN | NaN | NaN | NaN | 4 |
| 2 | parcel-bundler/parcel | parcel | ğŸ“¦ğŸš€ Blazing fast, zero configuration web applic... | 13981 | 463 | JavaScript | parcel-bundler | Parcel | Organization | NaN | NaN | NaN | NaN | NaN | 11 |
| 3 | Chalarangelo/30-seconds-of-code | 30-seconds-of-code | Curated collection of useful Javascript snippe... | 13466 | 1185 | JavaScript | Chalarangelo | Angelos Chalaris | User | Athens, Greece | 37.983810 | 23.727539 | Athens | Greece | 13 |
| 4 | wearehive/project-guidelines | project-guidelines | A set of best practices for JavaScript projects | 11279 | 970 | JavaScript | wearehive | Hive | Organization | London | 51.507351 | -0.127758 | London | United Kingdom | 16 |

## è¾“å‡ºç»“æœ

å°†ç»“æœå†™å‡ºåˆ° csv æ¥åœ¨ Tableau ä¸­å¯è§†åŒ–ï¼š

```py
users.to_csv('data/2017/users.csv', index=False)
repos_users.to_csv('data/2017/repos-users-geocodes.csv', index=False)
repos_users.to_csv('data/2017/repos-users.csv', index=False)

repos_rank = repos_users.reindex_axis(['full_name', 'rank'], axis=1)
repos_rank.to_csv('data/2017/repos-ranks.csv', index=False)
```
